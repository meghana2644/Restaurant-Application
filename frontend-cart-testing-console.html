<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frontend Cart Testing Console</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            padding: 20px; 
            background: #f5f5f5;
            margin: 0;
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 30px;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #007bff;
        }
        .test-section { 
            margin: 25px 0; 
            padding: 20px; 
            border: 1px solid #e0e0e0; 
            border-radius: 8px;
            background: #fafafa;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
        }
        .button { 
            padding: 12px 24px; 
            margin: 8px 5px; 
            background: #007bff; 
            color: white; 
            border: none; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }
        .button:hover { 
            background: #0056b3; 
            transform: translateY(-1px);
        }
        .button.success { background: #28a745; }
        .button.danger { background: #dc3545; }
        .button.warning { background: #ffc107; color: #212529; }
        .button.info { background: #17a2b8; }
        .result { 
            margin: 15px 0; 
            padding: 15px; 
            background: #f8f9fa; 
            border-radius: 6px; 
            font-family: 'Courier New', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            border-left: 4px solid #007bff;
            max-height: 300px;
            overflow-y: auto;
        }
        .error { background: #f8d7da; color: #721c24; border-left-color: #dc3545; }
        .success { background: #d4edda; color: #155724; border-left-color: #28a745; }
        .info { background: #d1ecf1; color: #0c5460; border-left-color: #17a2b8; }
        .warning { background: #fff3cd; color: #856404; border-left-color: #ffc107; }
        .input-group {
            margin: 15px 0;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }
        .input-group input, .input-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        .input-group textarea {
            height: 100px;
            resize: vertical;
        }
        .status-indicator {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        .status-online { background: #d4edda; color: #155724; }
        .status-offline { background: #f8d7da; color: #721c24; }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .iframe-container {
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            height: 500px;
        }
        .iframe-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõí Frontend Cart Testing Console</h1>
            <p>Comprehensive testing tools for cart functionality without backend dependency</p>
        </div>

        <div class="test-section">
            <h3>üåê Application Status</h3>
            <button class="button info" onclick="checkAppStatus()">Check Frontend Status</button>
            <button class="button warning" onclick="checkBackendStatus()">Check Backend Status</button>
            <div id="status-result" class="result info">Click buttons above to check application status...</div>
        </div>

        <div class="test-section">
            <h3>üì± Application Quick Access</h3>
            <div class="grid">
                <div class="iframe-container">
                    <iframe src="http://localhost:5173" title="Main Application"></iframe>
                </div>
                <div>
                    <h4>Quick Navigation</h4>
                    <button class="button" onclick="navigateApp('/')">Home Page</button>
                    <button class="button" onclick="navigateApp('/restaurants')">Restaurants</button>
                    <button class="button" onclick="navigateApp('/cart')">Cart Page</button>
                    <button class="button" onclick="navigateApp('/login')">Login Page</button>
                    <button class="button success" onclick="openInNewTab('http://localhost:5173')">Open in New Tab</button>
                    
                    <h4>Testing Instructions</h4>
                    <div class="result info" style="font-family: inherit; font-size: 14px;">
1. Navigate to a restaurant page
2. Open browser console (F12)
3. Try adding items to cart
4. Monitor console for debug logs
5. Check cart persistence
                    </div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h3>üíæ LocalStorage Cart Inspector</h3>
            <button class="button" onclick="inspectCart()">Inspect Cart Data</button>
            <button class="button warning" onclick="clearCart()">Clear Cart</button>
            <button class="button success" onclick="createTestCart()">Create Test Cart</button>
            <div id="localStorage-result" class="result">LocalStorage data will appear here...</div>
        </div>

        <div class="test-section">
            <h3>üß™ Cart Simulation</h3>
            <div class="input-group">
                <label>Test Item Name:</label>
                <input type="text" id="testItemName" value="Test Pizza" placeholder="Enter item name">
            </div>
            <div class="input-group">
                <label>Test Item Price:</label>
                <input type="number" id="testItemPrice" value="12.99" step="0.01" placeholder="Enter price">
            </div>
            <div class="input-group">
                <label>Restaurant ID:</label>
                <input type="text" id="testRestaurantId" value="restaurant123" placeholder="Enter restaurant ID">
            </div>
            <button class="button success" onclick="simulateAddToCart()">Simulate Add to Cart</button>
            <div id="simulation-result" class="result">Simulation results will appear here...</div>
        </div>

        <div class="test-section">
            <h3>üîç Debug Console</h3>
            <div class="input-group">
                <label>JavaScript Code to Execute:</label>
                <textarea id="debugCode" placeholder="Enter JavaScript code to execute in this context...">
// Example: Check if localStorage contains cart data
console.log('Current cart:', localStorage.getItem('cart'));
console.log('Restaurant ID:', localStorage.getItem('restaurantId'));</textarea>
            </div>
            <button class="button info" onclick="executeDebugCode()">Execute Code</button>
            <div id="debug-result" class="result">Debug output will appear here...</div>
        </div>

        <div class="test-section">
            <h3>üìã Test Checklist</h3>
            <div style="font-size: 14px; line-height: 1.6;">
                <label><input type="checkbox" id="test1"> Cart items can be added</label><br>
                <label><input type="checkbox" id="test2"> Cart persists across page refresh</label><br>
                <label><input type="checkbox" id="test3"> Cart page displays items correctly</label><br>
                <label><input type="checkbox" id="test4"> Quantity updates work</label><br>
                <label><input type="checkbox" id="test5"> Item removal works</label><br>
                <label><input type="checkbox" id="test6"> Restaurant switching shows confirmation</label><br>
                <label><input type="checkbox" id="test7"> LocalStorage updates correctly</label><br>
                <label><input type="checkbox" id="test8"> Console shows expected debug logs</label><br>
            </div>
            <button class="button success" onclick="generateTestReport()">Generate Test Report</button>
            <div id="report-result" class="result" style="display: none;"></div>
        </div>
    </div>

    <script>
        async function checkAppStatus() {
            const resultDiv = document.getElementById('status-result');
            resultDiv.innerHTML = 'Checking frontend status...';
            
            try {
                const response = await fetch('http://localhost:5173', { method: 'HEAD' });
                if (response.ok) {
                    resultDiv.innerHTML = '‚úÖ Frontend is running at http://localhost:5173';
                    resultDiv.className = 'result success';
                } else {
                    resultDiv.innerHTML = '‚ùå Frontend responded but with error status';
                    resultDiv.className = 'result warning';
                }
            } catch (error) {
                resultDiv.innerHTML = '‚ùå Frontend is not running. Please start with: npm run dev';
                resultDiv.className = 'result error';
            }
        }

        async function checkBackendStatus() {
            const resultDiv = document.getElementById('status-result');
            const currentContent = resultDiv.innerHTML;
            resultDiv.innerHTML = currentContent + '\n\nChecking backend status...';
            
            try {
                const response = await fetch('http://localhost:3000/api/restaurants', { method: 'HEAD' });
                if (response.ok) {
                    resultDiv.innerHTML = currentContent + '\n‚úÖ Backend is running at http://localhost:3000';
                    resultDiv.className = 'result success';
                } else {
                    resultDiv.innerHTML = currentContent + '\n‚ùå Backend responded but with error status';
                    resultDiv.className = 'result warning';
                }
            } catch (error) {
                resultDiv.innerHTML = currentContent + '\n‚ùå Backend is not running. Please start backend server.';
                resultDiv.className = 'result error';
            }
        }

        function navigateApp(path) {
            const iframe = document.querySelector('iframe');
            if (iframe) {
                iframe.src = 'http://localhost:5173' + path;
            }
        }

        function openInNewTab(url) {
            window.open(url, '_blank');
        }

        function inspectCart() {
            const resultDiv = document.getElementById('localStorage-result');
            const cart = localStorage.getItem('cart');
            const restaurantId = localStorage.getItem('restaurantId');
            
            let result = 'LocalStorage Cart Data:\n\n';
            result += `Cart Items: ${cart ? JSON.stringify(JSON.parse(cart), null, 2) : 'null'}\n\n`;
            result += `Restaurant ID: ${restaurantId || 'null'}\n\n`;
            result += `Item Count: ${cart ? JSON.parse(cart).length : 0}\n`;
            
            if (cart) {
                try {
                    const items = JSON.parse(cart);
                    const totalItems = items.reduce((sum, item) => sum + (item.quantity || 1), 0);                    const totalPrice = items.reduce((sum, item) => sum + ((item.price || 0) * (item.quantity || 1)), 0);
                    result += `Total Quantity: ${totalItems}\n`;
                    result += `Total Price: ‚Çπ${totalPrice.toFixed(2)}`;
                } catch (e) {
                    result += `Error parsing cart data: ${e.message}`;
                }
            }
            
            resultDiv.innerHTML = result;
            resultDiv.className = 'result info';
        }

        function clearCart() {
            localStorage.removeItem('cart');
            localStorage.removeItem('restaurantId');
            const resultDiv = document.getElementById('localStorage-result');
            resultDiv.innerHTML = '‚úÖ Cart cleared from localStorage';
            resultDiv.className = 'result success';
        }

        function createTestCart() {
            const testCart = [
                {
                    _id: 'item1',
                    name: 'Margherita Pizza',
                    price: 12.99,
                    quantity: 2,
                    restaurantId: 'restaurant123'
                },
                {
                    _id: 'item2',
                    name: 'Caesar Salad',
                    price: 8.99,
                    quantity: 1,
                    restaurantId: 'restaurant123'
                }
            ];
            
            localStorage.setItem('cart', JSON.stringify(testCart));
            localStorage.setItem('restaurantId', 'restaurant123');
            
            const resultDiv = document.getElementById('localStorage-result');
            resultDiv.innerHTML = '‚úÖ Test cart created with 2 items:\n\n' + JSON.stringify(testCart, null, 2);
            resultDiv.className = 'result success';
        }

        function simulateAddToCart() {
            const name = document.getElementById('testItemName').value;
            const price = parseFloat(document.getElementById('testItemPrice').value);
            const restaurantId = document.getElementById('testRestaurantId').value;
            
            if (!name || !price || !restaurantId) {
                const resultDiv = document.getElementById('simulation-result');
                resultDiv.innerHTML = '‚ùå Please fill in all fields';
                resultDiv.className = 'result error';
                return;
            }
            
            const newItem = {
                _id: 'simulated_' + Date.now(),
                name: name,
                price: price,
                quantity: 1,
                restaurantId: restaurantId
            };
            
            // Get existing cart
            let cart = [];
            const existingCart = localStorage.getItem('cart');
            if (existingCart) {
                cart = JSON.parse(existingCart);
            }
            
            // Add new item
            cart.push(newItem);
            localStorage.setItem('cart', JSON.stringify(cart));
            localStorage.setItem('restaurantId', restaurantId);
            
            const resultDiv = document.getElementById('simulation-result');
            resultDiv.innerHTML = `‚úÖ Simulated adding item to cart:\n\n${JSON.stringify(newItem, null, 2)}\n\nTotal items in cart: ${cart.length}`;
            resultDiv.className = 'result success';
        }

        function executeDebugCode() {
            const code = document.getElementById('debugCode').value;
            const resultDiv = document.getElementById('debug-result');
            
            try {
                // Capture console output
                const originalLog = console.log;
                let output = '';
                console.log = (...args) => {
                    output += args.map(arg => typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)).join(' ') + '\n';
                    originalLog.apply(console, args);
                };
                
                // Execute the code
                const result = eval(code);
                
                // Restore console.log
                console.log = originalLog;
                
                let finalOutput = '';
                if (output) {
                    finalOutput += 'Console Output:\n' + output + '\n';
                }
                if (result !== undefined) {
                    finalOutput += 'Return Value:\n' + (typeof result === 'object' ? JSON.stringify(result, null, 2) : String(result));
                }
                
                resultDiv.innerHTML = finalOutput || 'Code executed successfully (no output)';
                resultDiv.className = 'result success';
            } catch (error) {
                resultDiv.innerHTML = `‚ùå Error executing code:\n${error.message}`;
                resultDiv.className = 'result error';
            }
        }

        function generateTestReport() {
            const checkboxes = document.querySelectorAll('#test1, #test2, #test3, #test4, #test5, #test6, #test7, #test8');
            const resultDiv = document.getElementById('report-result');
            
            let report = 'Cart Testing Report\n';
            report += '==================\n\n';
            report += `Generated: ${new Date().toLocaleString()}\n\n`;
            
            let passedCount = 0;
            checkboxes.forEach((checkbox, index) => {
                const testName = checkbox.parentElement.textContent.trim();
                const status = checkbox.checked ? '‚úÖ PASS' : '‚ùå FAIL';
                report += `Test ${index + 1}: ${status} - ${testName}\n`;
                if (checkbox.checked) passedCount++;
            });
            
            report += `\nSummary: ${passedCount}/${checkboxes.length} tests passed\n`;
            report += `Success Rate: ${((passedCount / checkboxes.length) * 100).toFixed(1)}%\n\n`;
            
            // Add cart state
            const cart = localStorage.getItem('cart');
            const restaurantId = localStorage.getItem('restaurantId');
            report += 'Current Cart State:\n';
            report += `- Items: ${cart ? JSON.parse(cart).length : 0}\n`;
            report += `- Restaurant ID: ${restaurantId || 'none'}\n`;
            
            resultDiv.innerHTML = report;
            resultDiv.className = passedCount === checkboxes.length ? 'result success' : 'result warning';
            resultDiv.style.display = 'block';
        }

        // Auto-check status on load
        window.addEventListener('load', () => {
            setTimeout(() => {
                checkAppStatus();
            }, 1000);
        });
    </script>
</body>
</html>
